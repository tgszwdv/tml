<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>TML - Avaliação de Vídeos</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Tailwind CSS via CDN (for development only) -->
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <!-- Fonte futurista -->
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("https://raw.githubusercontent.com/tgszwdv/tgszwdv.github.io/main/bkg.avif");
        background-size: cover;
        background-position: center;
        font-family: "Orbitron", sans-serif;
      }

      .card-item {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        padding: 1rem;
        border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .card-item:hover {
        background-color: rgba(0, 255, 255, 0.05);
      }

      .card-label {
        font-weight: bold;
        color: rgba(0, 255, 255, 0.8);
      }

      .card-value {
        word-break: break-word;
      }

      .sortable-header {
        cursor: pointer;
        transition: all 0.2s;
      }

      .sortable-header:hover {
        background-color: rgba(0, 255, 255, 0.2);
      }

      @media (min-width: 768px) {
        .table-desktop {
          display: table;
        }
        .table-mobile {
          display: none;
        }
      }

      @media (max-width: 767px) {
        .table-desktop {
          display: none;
        }
        .table-mobile {
          display: block;
        }
      }
      #notification-modal,
      #confirm-modal {
        transition: opacity 0.3s ease;
      }

      #notification-modal > div:last-child,
      #confirm-modal > div:last-child {
        transform: translateY(20px);
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      #notification-modal:not(.hidden),
      #confirm-modal:not(.hidden) {
        opacity: 1;
      }

      #notification-modal:not(.hidden) > div:last-child,
      #confirm-modal:not(.hidden) > div:last-child {
        transform: translateY(0);
        opacity: 1;
      }
      /* Estilo para as linhas verticais na tabela desktop */
      .table-desktop table {
        border-collapse: collapse;
      }

      .table-desktop th,
      .table-desktop td {
        border-right: 1px solid rgba(0, 255, 255, 0.3);
        padding: 0.5rem;
      }

      .table-desktop th:last-child,
      .table-desktop td:last-child {
        border-right: none;
      }

      /* Estilo para as linhas verticais na tabela mobile */
      .card-item {
        grid-template-columns: 1fr 1fr;
        border-right: 1px solid rgba(0, 255, 255, 0.3);
      }

      .card-item > div:nth-child(even) {
        border-right: none;
      }

      .card-item > div {
        padding: 0.25rem;
      }
      .table-desktop th {
        border-bottom: 1px solid rgba(0, 255, 255, 0.5);
        border-right: 1px solid rgba(0, 255, 255, 0.5);
        padding: 0.75rem 0.5rem;
      }
      #share-modal a,
      #share-modal button {
        border: 1px solid rgba(0, 255, 255, 0.3);
        margin: 4px 0;
        transition: all 0.2s;
      }

      #share-modal a:hover,
      #share-modal button:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 255, 255, 0.2);
      }

      #share-modal img {
        filter: drop-shadow(0 0 2px rgba(0, 255, 255, 0.5));
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col items-center text-white px-4 py-8">
    <h1
      class="text-4xl md:text-5xl text-center mb-6 drop-shadow-[0_0_6px_rgba(0,255,255,0.8)]"
    >
      TML - SEXTA
    </h1>
    <div class="w-full">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center">
          <!-- Efeito de neon animado -->
          <div class="relative group">
            <span
              class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 text-2xl font-bold tracking-wider"
            >
              @tgszwdv
            </span>
            <span
              class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-cyan-400 to-blue-500 transition-all duration-300 group-hover:w-full"
            ></span>
          </div>
        </div>
      </div>
    </div>

    <div
      id="video-container"
      class="mb-6 w-full max-w-[720px] rounded-xl border border-cyan-400 backdrop-blur-sm bg-white/10 shadow-[0_0_20px_rgba(0,255,255,0.3)]"
    >
      <iframe
        id="meu-iframe"
        class="w-full aspect-video rounded-xl"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen
      ></iframe>
    </div>

    <p
      id="video-info"
      class="text-lg md:text-xl text-center mb-6 drop-shadow-[0_0_6px_rgba(0,255,255,0.8)]"
    ></p>

    <div
      class="flex flex-wrap items-center justify-center gap-4 mb-6 backdrop-blur-sm bg-white/10 px-4 py-4 rounded-xl border border-cyan-400 shadow-[0_0_20px_rgba(0,255,255,0.3)]"
    >
      <button
        id="exportar"
        class="bg-cyan-400/20 hover:bg-cyan-300/20 text-white border border-cyan-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition"
      >
        Exportar Tabela
      </button>

      <label for="nota" class="text-white">Nota:</label>
      <input
        type="number"
        id="nota"
        min="0"
        max="10"
        step="0.1"
        class="w-20 text-center text-white bg-white/10 border-b-2 border-cyan-300 focus:border-cyan-400 outline-none py-1 backdrop-blur-md"
        placeholder="0-10"
      />

      <button
        id="proximo"
        class="bg-cyan-400/20 hover:bg-cyan-300/20 text-white border border-cyan-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition"
      >
        Próximo vídeo
      </button>

      <button
        id="resetar"
        class="bg-red-500/30 hover:bg-red-400/30 text-white border border-red-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition"
      >
        Resetar Notas
      </button>

      <button
        id="compartilhar"
        class="bg-green-500/20 hover:bg-green-400/20 text-white border border-green-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition flex items-center gap-2"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"
          />
        </svg>
      </button>
    </div>

    <!-- Tabela para desktop -->
    <div
      class="table-desktop overflow-x-auto w-full max-w-5xl backdrop-blur-md bg-white/10 border border-cyan-400 rounded-xl shadow-[0_0_20px_rgba(0,255,255,0.3)]"
    >
      <table class="w-full text-sm text-white text-center">
        <thead class="bg-cyan-400/20 text-white">
          <tr>
            <th id="headerNome" class="p-2 sortable-header">Nome</th>
            <th id="headerNota" class="p-2 sortable-header">Nota</th>
            <th id="headerStyle" class="p-2 sortable-header">Gênero</th>
            <th id="headerPalco" class="p-2 sortable-header">Palco</th>
            <th id="headerHorario" class="p-2 sortable-header">Horário</th>
            <th class="p-2">Opção</th>
          </tr>
        </thead>
        <tbody id="tabela-notas-desktop" class="divide-y divide-cyan-400/50">
          <!-- preenchido dinamicamente -->
        </tbody>
      </table>
    </div>

    <!-- Tabela para mobile -->
    <div
      id="tabela-notas-mobile"
      class="table-mobile w-full max-w-5xl backdrop-blur-md bg-white/10 border border-cyan-400 rounded-xl shadow-[0_0_20px_rgba(0,255,255,0.3)]"
    >
      <!-- preenchido dinamicamente -->
    </div>

    <!-- Scripts -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
      // Constantes e configurações
      const VIDEO_STORAGE_KEY = "sextaNotas";
      const INDEX_STORAGE_KEY = "indiceSexta";
      const MAX_INDEX = 45;

      // Elementos do DOM
      const elements = {
        iframe: document.querySelector("#meu-iframe"),
        tabelaDesktop: document.querySelector("#tabela-notas-desktop"),
        tabelaMobile: document.querySelector("#tabela-notas-mobile"),
        videoInfo: document.getElementById("video-info"),
        proximoBtn: document.querySelector("#proximo"),
        resetarBtn: document.querySelector("#resetar"),
        exportarBtn: document.querySelector("#exportar"),
        notaInput: document.querySelector("#nota"),
        headers: {
          nome: document.getElementById("headerNome"),
          nota: document.getElementById("headerNota"),
          palco: document.getElementById("headerPalco"),
          horario: document.getElementById("headerHorario"),
          style: document.getElementById("headerStyle"),
        },
      };

      // Estado da aplicação
      let state = {
        indice: 0,
        videos: getInitialVideos(),
      };

      // Funções de estado
      function getInitialVideos() {
        return [
          {
            link: "https://www.youtube.com/embed/pg5foEhBW2c",
            nome: "Beltran",
            style: "Deephouse",
            palco: "Essence by Beck's",
            horario: "14:00 - 15:30",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/rPRSIizQ6t0",
            nome: "Due",
            style: "House",
            palco: "CORE",
            horario: "14:00 - 15:30",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/2SMxKLTJAy4",
            nome: "Jessica Brankka",
            style: "House/Techno",
            palco: "Mainstage",
            horario: "14:00 - 15:30",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/ihkNRJD7Nng",
            nome: "Doozie",
            style: "Deephouse",
            palco: "Youphoria",
            horario: "15:00 - 16:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/hf0YbhqY-Ew?t=4875",
            nome: "Fernanda Pistelli",
            style: "Psy Trance",
            palco: "Tulip",
            horario: "15:00 - 16:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/BHwvMQeQVME",
            nome: "KVSH ",
            style: "Deephouse",
            palco: "Mainstage",
            horario: "15:30 - 16:30",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/yi6d1kWsHSM?t=1272",
            nome: "Gabe ",
            style: "Deephouse",
            palco: "Essence by Beck's",
            horario: "15:30 - 17:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/IygyK03E1bY",
            nome: "Mila Journée",
            style: "Melodic/Deep House",
            palco: "CORE",
            horario: "15:30 - 17:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/E-CdJFlKyNc?t=1865",
            nome: "Aura Vortex",
            style: "Psy Trance",
            palco: "Tulip",
            horario: "16:00 - 17:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/ZPhcmTsh1FQ",
            nome: "Dj Glen",
            style: "House Classics/DeepHouse",
            palco: "Youphoria",
            horario: "16:00 - 17:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/o8UEQXwfXIQ",
            nome: "Carola",
            style: "Deephouse",
            palco: "Mainstage",
            horario: "16:30 - 17:30",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/3wRtMN19JLM?t=2651",
            nome: "Freedom Fighters",
            style: "Psy Trance",
            palco: "Tulip",
            horario: "17:00 - 18:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/UT_66xW3lck",
            nome: "Jørd ",
            style: "Deephouse",
            palco: "Youphoria",
            horario: "17:00 - 18:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/_Lum1rSjs6w?t=1160",
            nome: "Capoon ",
            style: "Underground/Organic",
            palco: "CORE",
            horario: "17:00 - 18:30",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/n6ei2S1t6tI",
            nome: "Layla Benitez ",
            style: "Indie/Dance",
            palco: "Essence by Beck's",
            horario: "17:00 - 18:30",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/sK54sgHQBDc",
            nome: "Cat Dealers",
            style: "Deephouse",
            palco: "Mainstage",
            horario: "17:35 - 18:35",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/6GHiYo3530o?t=4154",
            nome: "Liquid Soul",
            style: "Psy Trance",
            palco: "Tulip",
            horario: "18:00 - 19:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/4y9BzMAE3FY?t=346",
            nome: "Meca ",
            style: "Melodic/Deep House",
            palco: "Youphoria",
            horario: "18:00 - 19:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/4r-M7lqUSKo",
            nome: "Dino Lenny",
            style: "Techno/Underground",
            palco: "CORE",
            horario: "18:30 - 20:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/0XgH-zAGvwA",
            nome: "Francis Mercier",
            style: "Dance",
            palco: "Essence by Beck's",
            horario: "18:30 - 20:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/U0rD-PMKAt4",
            nome: "B Jones",
            style: "Deephouse",
            palco: "Mainstage",
            horario: "18:40 - 19:40",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/CVKBlYp62M8",
            nome: "Chapeleiro",
            style: "Psy Trance",
            palco: "Tulip",
            horario: "19:00 - 20:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/P9mnmm-zxcI",
            nome: "Liu",
            style: "Deephouse",
            palco: "Youphoria",
            horario: "19:00 - 20:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/r9O_lNCx5EA",
            nome: "Nervo",
            style: "House/Psy/ElectroHouse/ProgressiveHouse",
            palco: "Mainstage",
            horario: "19:40 - 20:40",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/tyoSiO9Iccw",
            nome: "Blastoyz",
            style: "Psy Trance",
            palco: "Tulip",
            horario: "20:00 - 21:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/5hZzU7Jhr0I?t=1035",
            nome: "Chemical Surf",
            style: "Deephouse",
            palco: "Youphoria",
            horario: "20:00 - 21:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/6dB0n_mLqJA",
            nome: "Jaguar",
            style: "House",
            palco: "CORE",
            horario: "20:00 - 22:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/9ynMx2qAYAE",
            nome: "Korolova ",
            style: "Melodic Trance",
            palco: "Essence by Beck's",
            horario: "20:00 - 22:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/0Settohf92Q",
            nome: "ANNA ",
            style: "Dance/EDM",
            palco: "Mainstage",
            horario: "20:40 - 21:40",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/psHA5maXX_4?t=1464",
            nome: "Coone",
            style: "HardStyle",
            palco: "Tulip",
            horario: "21:00 - 22:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/MPt3z9ISwCs?t=2726",
            nome: "Pretty Pink",
            style: "Trance/Melodic Trance/AjunaDeeps",
            palco: "Youphoria",
            horario: "21:00 - 22:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/aAnHOnEF_PI",
            nome: "Vintage Culture",
            style: "Deephouse/Future House/Trance/Tropical House",
            palco: "Mainstage",
            horario: "21:45 - 22:45",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/cCOJdwxpme8",
            nome: "Gordo ",
            style: "Deephouse",
            palco: "Essence by Beck's",
            horario: "22:00 - 00:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/NgetGgcdEd4",
            nome: "Skepta",
            style: "raper ? Wtf tml",
            palco: "CORE",
            horario: "22:00 - 00:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/rMzSGJLYkCM",
            nome: "Mandy",
            style: "HardStyle",
            palco: "Tulip",
            horario: "22:00 - 23:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/z0yYfuTqxn4",
            nome: "Ownboss",
            style: "Deephouse",
            palco: "Youphoria",
            horario: "22:00 - 23:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/7DE0TAz5xbg?t=1480",
            nome: "Sebastian Ingrosso",
            style: "House/Dance/Progressive House",
            palco: "Mainstage",
            horario: "22:50 - 23:50",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/U7JKifvBAbQ",
            nome: "Bakermat",
            style: "Dance/Pop/SoulHouse",
            palco: "Youphoria",
            horario: "23:00 - 00:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/jO7_r2nf__k",
            nome: "Da Tweekaz",
            style: "HardStyle",
            palco: "Tulip",
            horario: "23:00 - 00:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/A4lTUgJWNIw",
            nome: "Dimitri vegas & Like mike",
            style: "Big Room/Trance/Techno",
            palco: "Mainstage",
            horario: "23:50 - 00:50",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/IajHfZrqS4w",
            nome: "Lost Frequencies",
            style: "Tropical House/DownTempo",
            palco: "Youphoria",
            horario: "00:00 - 01:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/iIQVr40Mnw4",
            nome: "Sub Zero Project",
            style: "Drum And Bass/Hardstyle",
            palco: "Tulip",
            horario: "00:00 - 01:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/Gy0RM9yjyhM",
            nome: "Âme",
            style: "House/Techno",
            palco: "CORE",
            horario: "00:00 - 02:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/emEARENszec",
            nome: "Purple Disco Machine",
            style: "Nu-disco/House",
            palco: "Essence by Beck's",
            horario: "00:00 - 02:00",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/5LlAC5FN59Y",
            nome: "Steve Aoki",
            style: "EDM/Progressive House/Big Room/Future Bass",
            palco: "Mainstage",
            horario: "00:50 - 01:50",
            nota: "",
          },
          {
            link: "https://www.youtube.com/embed/geU67GxTIFg",
            nome: "Acraze",
            style: "Deephouse",
            palco: "Youphoria",
            horario: "01:00 - 02:00",
            nota: "",
          },
        ];
      }

      // Inicialização
      function init() {
        try {
          loadState();
          updateVideoDisplay();
          setupEventListeners();
          updateTable();
          setupSharing();
        } catch (error) {
          console.error("Erro na inicialização:", error);
          alert(
            "Ocorreu um erro ao inicializar a aplicação. Por favor, recarregue a página."
          );
        }
      }

      function loadState() {
        try {
          const savedIndex =
            parseInt(localStorage.getItem(INDEX_STORAGE_KEY)) || 0;
          const savedVideos =
            JSON.parse(localStorage.getItem(VIDEO_STORAGE_KEY)) ||
            getInitialVideos();

          state.indice = savedIndex >= MAX_INDEX ? 0 : savedIndex;
          state.videos =
            Array.isArray(savedVideos) && savedVideos.length
              ? savedVideos
              : getInitialVideos();
        } catch (error) {
          console.error("Erro ao carregar estado:", error);
          state.indice = 0;
          state.videos = getInitialVideos();
        }
      }

      function saveState() {
        try {
          localStorage.setItem(VIDEO_STORAGE_KEY, JSON.stringify(state.videos));
          localStorage.setItem(INDEX_STORAGE_KEY, JSON.stringify(state.indice));
        } catch (error) {
          console.error("Erro ao salvar estado:", error);
        }
      }

      // Funções de exibição
      function updateVideoDisplay() {
        try {
          if (!state.videos || !state.videos.length) {
            console.error("Nenhum vídeo disponível");
            return;
          }

          // Garantir que o índice está dentro dos limites
          if (state.indice >= state.videos.length) {
            state.indice = 0;
          }

          const currentVideo = state.videos[state.indice];
          if (!currentVideo) {
            console.error("Índice de vídeo inválido:", state.indice);
            return;
          }

          if (elements.iframe) {
            elements.iframe.src = currentVideo.link || "";
          }

          if (elements.videoInfo) {
            elements.videoInfo.textContent =
              currentVideo.nome && currentVideo.style
                ? `${currentVideo.nome} - ${currentVideo.style}`
                : "Informações do vídeo não disponíveis";
          }

          if (elements.notaInput) {
            elements.notaInput.value = "";
            elements.notaInput.focus();
          }
        } catch (error) {
          console.error("Erro ao atualizar exibição do vídeo:", error);
        }
      }

      function createTableRow(video, index) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
                <td class="p-2">${video.nome || ""}</td>
                <td class="p-2">${video.nota || ""}</td>
                <td class="p-2">${video.style || ""}</td>
                <td class="p-2">${video.palco || ""}</td>
                <td class="p-2">${video.horario || ""}</td>
              `;

        const editBtn = createEditButton(video);
        const td = document.createElement("td");
        td.className = "p-2";
        td.appendChild(editBtn);
        tr.appendChild(td);

        tr.addEventListener("click", () => navigateToVideo(index));

        return tr;
      }

      function createMobileCard(video, index) {
        const card = document.createElement("div");
        card.className = "card-item";
        card.innerHTML = `
                <div class="card-label">Nome:</div>
                <div class="card-value">${video.nome || ""}</div>
                <div class="card-label">Nota:</div>
                <div class="card-value">${video.nota || ""}</div>
                <div class="card-label">Gênero:</div>
                <div class="card-value">${video.style || ""}</div>
                <div class="card-label">Palco:</div>
                <div class="card-value">${video.palco || ""}</div>
                <div class="card-label">Horário:</div>
                <div class="card-value">${video.horario || ""}</div>
              `;

        const editBtn = createEditButton(video);
        editBtn.classList.add("col-span-2", "mx-auto", "mt-2");
        card.appendChild(editBtn);

        card.addEventListener("click", () => navigateToVideo(index));

        return card;
      }

      function createEditButton(video) {
        const btn = document.createElement("button");
        btn.textContent = "Editar";
        btn.className =
          "bg-cyan-400/20 hover:bg-cyan-300/20 text-white border border-cyan-300 px-2 py-1 rounded text-xs";

        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          editVideoNote(video);
        });

        return btn;
      }

      function editVideoNote(video) {
        const novaNota = prompt("Insira a nova nota para o vídeo:");
        if (novaNota !== null && !isNaN(novaNota)) {
          const notaNum = parseFloat(novaNota);
          if (notaNum >= 0 && notaNum <= 10) {
            video.nota = notaNum;
            updateTable();
            saveState();
          } else {
            showNotification("Atenção", "A nota deve estar entre 0 e 10.");
          }
        }
      }

      function updateTable() {
        try {
          // Limpar tabelas
          if (elements.tabelaDesktop) elements.tabelaDesktop.innerHTML = "";
          if (elements.tabelaMobile) elements.tabelaMobile.innerHTML = "";

          // Preencher tabelas
          state.videos.forEach((video, index) => {
            if (elements.tabelaDesktop) {
              elements.tabelaDesktop.appendChild(createTableRow(video, index));
            }
            if (elements.tabelaMobile) {
              elements.tabelaMobile.appendChild(createMobileCard(video, index));
            }
          });
        } catch (error) {
          console.error("Erro ao atualizar tabela:", error);
        }
      }

      // Navegação
      function navigateToVideo(index) {
        try {
          if (index >= 0 && index < state.videos.length) {
            state.indice = index;
            updateVideoDisplay();
          }
        } catch (error) {
          console.error("Erro ao navegar para vídeo:", error);
        }
      }

      function nextVideo() {
        try {
          const nota = parseFloat(elements.notaInput.value);

          if (isNaN(nota) || nota < 0 || nota > 10) {
            showNotification(
              "Atenção",
              "Por favor, insira uma nota válida entre 0 e 10."
            );
            return;
          }

          // Atualizar nota do vídeo atual
          state.videos[state.indice].nota = nota;

          // Avançar para o próximo vídeo
          state.indice++;

          if (state.indice >= state.videos.length) {
            showNotification("Parabéns", "Você avaliou todos os vídeos!");
            state.indice = 0;
          }

          saveState();
          updateVideoDisplay();
          updateTable();
        } catch (error) {
          console.error("Erro ao avançar para próximo vídeo:", error);
          showNotification(
            "Erro",
            "Ocorreu um erro ao processar. Por favor, tente novamente."
          );
        }
      }

      async function resetApp() {
        const confirmed = await showConfirm(
          "Confirmação",
          "Tem certeza que deseja resetar todas as notas?"
        );
        if (confirmed) {
          try {
            state.indice = 0;
            state.videos.forEach((video) => (video.nota = ""));
            saveState();
            updateTable();
            updateVideoDisplay();
            showNotification("Sucesso", "Todas as notas foram resetadas.");
          } catch (error) {
            console.error("Erro ao resetar aplicação:", error);
            showNotification("Erro", "Ocorreu um erro ao resetar as notas.");
          }
        }
      }

      // Exportação
      function exportTable() {
        try {
          const tabela = document.createElement("table");
          tabela.classList.add("tabela-export");

          // Cabeçalho
          const cabecalho = tabela.createTHead();
          const rowCabecalho = cabecalho.insertRow(0);
          const headers = ["Nome", "Nota", "Estilo", "Palco", "Horario"];

          headers.forEach((headerText) => {
            const th = document.createElement("th");
            th.innerHTML = `<strong>${headerText}</strong>`;
            rowCabecalho.appendChild(th);
          });

          // Conteúdo
          const corpoTabela = tabela.createTBody();
          state.videos.forEach((video) => {
            const tr = corpoTabela.insertRow();
            [
              video.nome,
              video.nota,
              video.style,
              video.palco,
              video.horario,
            ].forEach((value) => {
              const td = tr.insertCell();
              td.textContent =
                value !== undefined && value !== null ? value : "";
            });
          });

          document.body.appendChild(tabela);

          html2canvas(tabela, {
            backgroundColor: "#000000",
            scale: 2, // Melhora a qualidade da imagem exportada
          })
            .then(function (canvas) {
              const link = document.createElement("a");
              link.download = `avaliacoes_tml_${new Date()
                .toISOString()
                .slice(0, 10)}.png`;
              link.href = canvas.toDataURL("image/png");
              link.click();
              document.body.removeChild(tabela);
            })
            .catch((error) => {
              console.error("Erro ao exportar tabela:", error);
              alert("Erro ao exportar tabela. Por favor, tente novamente.");
            });
        } catch (error) {
          console.error("Erro na exportação:", error);
        }
      }

      // Ordenação
      function setupSorting() {
        if (elements.headers.nota) {
          elements.headers.nota.addEventListener("click", () => {
            state.videos.sort((a, b) => (b.nota || 0) - (a.nota || 0));
            updateTable();
          });
        }

        if (elements.headers.palco) {
          elements.headers.palco.addEventListener("click", () => {
            state.videos.sort((a, b) =>
              (a.palco || "").localeCompare(b.palco || "")
            );
            updateTable();
          });
        }

        if (elements.headers.horario) {
          elements.headers.horario.addEventListener("click", () => {
            window.location.reload();
          });
        }

        if (elements.headers.style) {
          elements.headers.style.addEventListener("click", () => {
            state.videos.sort((a, b) =>
              (a.style || "").localeCompare(b.style || "")
            );
            updateTable();
          });
        }

        if (elements.headers.nome) {
          elements.headers.nome.addEventListener("click", () => {
            state.videos.sort((a, b) =>
              (a.nome || "").localeCompare(b.nome || "")
            );
            updateTable();
          });
        }
      }

      // Configuração de eventos
      function setupEventListeners() {
        if (elements.proximoBtn) {
          elements.proximoBtn.addEventListener("click", nextVideo);
        }

        if (elements.resetarBtn) {
          elements.resetarBtn.addEventListener("click", resetApp);
        }

        if (elements.exportarBtn) {
          elements.exportarBtn.addEventListener("click", exportTable);
        }

        setupSorting();
      }

      function showNotification(title, message, duration = 3000) {
        const modal = document.getElementById("notification-modal");
        const modalTitle = document.getElementById("notification-title");
        const modalMessage = document.getElementById("notification-message");
        const confirmBtn = document.getElementById("notification-confirm");

        modalTitle.textContent = title;
        modalMessage.textContent = message;
        modal.classList.remove("hidden");

        confirmBtn.onclick = () => {
          modal.classList.add("hidden");
        };

        // Fechar automaticamente após 'duration' milissegundos
        setTimeout(() => {
          if (!modal.classList.contains("hidden")) {
            modal.classList.add("hidden");
          }
        }, duration);
      }
      function setupEventListeners() {
        if (elements.proximoBtn) {
          elements.proximoBtn.addEventListener("click", nextVideo);
        }

        if (elements.resetarBtn) {
          elements.resetarBtn.addEventListener("click", resetApp);
        }

        if (elements.exportarBtn) {
          elements.exportarBtn.addEventListener("click", exportTable);
        }

        // Adicione este novo listener para o campo de nota
        if (elements.notaInput) {
          elements.notaInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
              nextVideo();
            }
          });
        }

        setupSorting();
      }

      function showConfirm(title, message) {
        return new Promise((resolve) => {
          const modal = document.getElementById("confirm-modal");
          const modalMessage = document.getElementById("confirm-message");
          const cancelBtn = document.getElementById("confirm-cancel");
          const okBtn = document.getElementById("confirm-ok");

          modalMessage.textContent = message;
          modal.classList.remove("hidden");

          cancelBtn.onclick = () => {
            modal.classList.add("hidden");
            resolve(false);
          };

          okBtn.onclick = () => {
            modal.classList.add("hidden");
            resolve(true);
          };
        });
      }

      function setupSharing() {
        const shareBtn = document.getElementById("compartilhar");
        const shareModal = document.getElementById("share-modal");
        const shareCloseBtn = document.getElementById("share-close");

        if (shareBtn && shareModal) {
          shareBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            shareModal.classList.remove("hidden");
          });

          if (shareCloseBtn) {
            shareCloseBtn.addEventListener("click", () => {
              shareModal.classList.add("hidden");
            });
          }

          // Fechar modal quando clicar fora
          shareModal.addEventListener("click", (e) => {
            if (e.target === shareModal) {
              shareModal.classList.add("hidden");
            }
          });

          // Configurar ações de compartilhamento
          setupSocialSharing();
        }
      }
      function setupSocialSharing() {
        const currentVideo = state.videos[state.indice];
        const shareText = `Estou avaliando ${currentVideo.nome} no Tomorrowland! Dê uma olhada:`;
        const shareUrl = window.location.href;

        // WhatsApp
        const whatsappBtn = document.getElementById("share-whatsapp");
        if (whatsappBtn) {
          whatsappBtn.addEventListener("click", (e) => {
            e.preventDefault();
            window.open(
              `https://wa.me/?text=${encodeURIComponent(
                shareText + " " + shareUrl
              )}`,
              "_blank"
            );
          });
        }

        // Twitter
        const twitterBtn = document.getElementById("share-twitter");
        if (twitterBtn) {
          twitterBtn.addEventListener("click", (e) => {
            e.preventDefault();
            window.open(
              `https://twitter.com/intent/tweet?text=${encodeURIComponent(
                shareText
              )}&url=${encodeURIComponent(shareUrl)}`,
              "_blank"
            );
          });
        }

        // Facebook
        const facebookBtn = document.getElementById("share-facebook");
        if (facebookBtn) {
          facebookBtn.addEventListener("click", (e) => {
            e.preventDefault();
            window.open(
              `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(
                shareUrl
              )}&quote=${encodeURIComponent(shareText)}`,
              "_blank"
            );
          });
        }

        // Copiar link
        const copyLinkBtn = document.getElementById("copy-link");
        if (copyLinkBtn) {
          copyLinkBtn.addEventListener("click", async (e) => {
            e.preventDefault();
            try {
              await navigator.clipboard.writeText(shareUrl);
              showNotification(
                "Sucesso",
                "Link copiado para a área de transferência!"
              );
              document.getElementById("share-modal").classList.add("hidden");
            } catch (err) {
              console.error("Falha ao copiar link:", err);
              showNotification("Erro", "Não foi possível copiar o link.");
            }
          });
        }
      }
      // Inicializar aplicação quando o DOM estiver pronto
      document.addEventListener("DOMContentLoaded", init);
    </script>

    <!-- Modal de Notificação -->
    <div
      id="notification-modal"
      class="fixed inset-0 flex items-center justify-center z-50 hidden"
    >
      <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
      <div
        class="relative bg-gradient-to-br from-cyan-900/90 to-blue-900/90 border border-cyan-400 rounded-xl p-6 max-w-md w-full mx-4 shadow-[0_0_30px_rgba(0,255,255,0.5)]"
      >
        <h3
          id="notification-title"
          class="text-2xl font-bold mb-4 text-cyan-300"
        ></h3>
        <p id="notification-message" class="mb-6"></p>
        <div class="flex justify-end">
          <button
            id="notification-confirm"
            class="bg-cyan-500/20 hover:bg-cyan-400/30 text-white border border-cyan-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition"
          >
            OK
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de Confirmação -->
    <div
      id="confirm-modal"
      class="fixed inset-0 flex items-center justify-center z-50 hidden"
    >
      <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
      <div
        class="relative bg-gradient-to-br from-cyan-900/90 to-blue-900/90 border border-cyan-400 rounded-xl p-6 max-w-md w-full mx-4 shadow-[0_0_30px_rgba(0,255,255,0.5)]"
      >
        <h3 id="confirm-title" class="text-2xl font-bold mb-4 text-cyan-300">
          Confirmação
        </h3>
        <p id="confirm-message" class="mb-6"></p>
        <div class="flex justify-end gap-4">
          <button
            id="confirm-cancel"
            class="bg-red-500/20 hover:bg-red-400/30 text-white border border-red-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition"
          >
            Cancelar
          </button>
          <button
            id="confirm-ok"
            class="bg-cyan-500/20 hover:bg-cyan-400/30 text-white border border-cyan-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition"
          >
            Confirmar
          </button>
        </div>
      </div>
    </div>
    <div
      id="share-modal"
      class="fixed inset-0 flex items-center justify-center z-50 hidden"
    >
      <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
      <div
        class="relative bg-gradient-to-br from-cyan-900/90 to-blue-900/90 border border-cyan-400 rounded-xl p-6 max-w-md w-full mx-4 shadow-[0_0_30px_rgba(0,255,255,0.5)]"
      >
        <h3 class="text-2xl font-bold mb-4 text-cyan-300">Compartilhar</h3>
        <div class="flex flex-col gap-2">
          <a
            id="share-whatsapp"
            href="#"
            class="bg-green-500/20 hover:bg-green-400/30 text-white px-4 py-3 rounded-lg flex items-center gap-3"
          >
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg"
              alt="WhatsApp"
              class="h-6 w-6"
            />
            WhatsApp
          </a>
          <a
            id="share-twitter"
            href="#"
            class="bg-blue-500/20 hover:bg-blue-400/30 text-white px-4 py-3 rounded-lg flex items-center gap-3"
          >
            <img
              src="https://img.freepik.com/vetores-premium/novo-vector-twitter-x-logo-branco-em-fundo-preto_744381-866.jpg"
              alt="Twitter"
              class="h-6 w-6"
            />
            X
          </a>
          <a
            id="share-facebook"
            href="#"
            class="bg-blue-700/20 hover:bg-blue-600/30 text-white px-4 py-3 rounded-lg flex items-center gap-3"
          >
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"
              alt="Facebook"
              class="h-6 w-6"
            />
            Facebook
          </a>
          <button
            id="copy-link"
            class="bg-cyan-500/20 hover:bg-cyan-400/30 text-white px-4 py-3 rounded-lg flex items-center gap-3"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
              />
            </svg>
            Copiar Link
          </button>
        </div>
        <div class="flex justify-end mt-4">
          <button
            id="share-close"
            class="bg-red-500/20 hover:bg-red-400/30 text-white border border-red-300 px-4 py-2 rounded-lg shadow-lg backdrop-blur-md transition"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
